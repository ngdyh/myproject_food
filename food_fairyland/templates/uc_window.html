{% extends 'uc_base.html' %}
{% load staticfiles %}

{% block liactive1 %}active{% endblock %}

{% block uc_content %}
<!-- 显示框 -->
<div class="col-lg-12">
    <div class="panel">
        <div class="panel-body">
            <h4>个人信息</h4>
            <hr/>
            <div class="row">
                <div class="col-lg-3 col-md-3">
                    <div class="up-img-cover"  id="up-img-touch" >
                        <img class="am-circle" alt="点击图片上传" src="{% static 'img/uc/h_photo/default.jpg' %}" data-am-popover="{content: '点击上传', trigger: 'hover focus'}" >
                    </div>
                    <div class="uc_center_picture">
                        <a style="text-align: center; display: block;"  id="pic"></a>
                    </div>
                    <div>
                        <textarea id="uc_intro" type="text" class="uc_intro" placeholder="编辑个人签名" onfocus="operateFocus()" onblur="operateBlur()" maxlength="60">{{ request.user.intro }}</textarea>
                    </div>
                </div>
                <div class="col-lg-6 col-lg-6">

                </div>
                <div class="col-lg-6 col-md-6">
                    <form action="{% url 'uc:profile' %}" class="form-horizontal" role="form" method="post">
                        {% csrf_token %}
                        <div class="uc_center_msg">
                            <label for="inputUserName" class="col-lg-3 control-label">用户名：</label>
                            <div class="col-lg-9 uc_center_input">
                                <input name="username" type="text" class="form-control" id="inputUserName" value="{{ request.user.username }}" placeholder="请输入用户名" required>
                            </div>
                        </div>
                        <div class="uc_center_msg">
                            <label for="inputEmail" class="col-lg-3 control-label">邮箱：</label>
                            <div class="col-lg-9 uc_center_input">
                                <input name="email" type="email" class="form-control" id="inputEmail" value="{{ request.user.email }}" placeholder="请输入邮箱" required>
                            </div>
                        </div>
                        <div class="uc_center_msg">
                            <label for="inputTel" class="col-lg-3 control-label">手机号：</label>
                            <div class="col-lg-9 uc_center_input">
                                <input name="mobile" type="tel" class="form-control" id="inputTel" value="{{ request.user.mobile }}" placeholder="暂无手机号" required>
                            </div>
                        </div>
                        <div class="uc_center_msg">
                            <label for="inputQQ" class="col-lg-3 control-label">QQ：</label>
                            <div class="col-lg-9 uc_center_input">
                                <input name="qq" type="text" class="form-control" id="inputQQ" value="{{ request.user.qq }}"  minlength="5" placeholder="暂无qq号" required>
                            </div>
                        </div>
                        <div class="uc_center_msg">
                            <div class="col-lg-offset-3 col-lg-9 uc_center_input uc_center_btn">
                                <button type="submit" class="btn btn-danger">提交</button>
                            </div>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>

<!--图片上传框-->
<div class="am-modal am-modal-no-btn up-frame-bj " tabindex="-1" id="doc-modal-1">
    <div class="am-modal-dialog up-frame-parent up-frame-radius">
        <div class="am-modal-hd up-frame-header">
            <label>修改头像</label>
            <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
        </div>
        <div class="am-modal-bd  up-frame-body">
            <div class="am-g am-fl">
                <div class="am-form-group am-form-file">
                    <div class="am-fl">
                        <button type="button" class="am-btn am-btn-default am-btn-sm">
                            <i class="am-icon-cloud-upload"></i> 选择要上传的文件</button>
                    </div>
                    <input type="file" id="inputImage">
                </div>
            </div>
            <div class="am-g am-fl" >
                <div class="up-pre-before up-frame-radius">
                    <img alt="" src="" id="image" >
                </div>
                <div class="up-pre-after up-frame-radius">

                </div>
            </div>
            <div class="am-g am-fl">
                <div class="up-control-btns">
                    <span class="am-icon-rotate-left"  onclick="rotateimgleft()"></span>
                    <span class="am-icon-rotate-right" onClick="rotateimgright()"></span>
                    <span class="am-icon-check" id="up-btn-ok" url="/apis/change_avator/"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<!--加载框-->
<div class="am-modal am-modal-loading am-modal-no-btn" tabindex="-1" id="my-modal-loading">
    <div class="am-modal-dialog">
        <div class="am-modal-hd">正在上传...</div>
        <div class="am-modal-bd">
            <span class="am-icon-spinner am-icon-spin"></span>
        </div>
    </div>
</div>

<!--警告框-->
<div class="am-modal am-modal-alert" tabindex="-1" id="my-alert">
                    <div class="am-modal-dialog">
                        <div class="am-modal-hd">信息</div>
                        <div class="am-modal-bd"  id="alert_content">
                            成功了
                        </div>
                        <div class="am-modal-footer">
                            <span class="am-modal-btn">确定</span>
                        </div>
                    </div>
                </div>
{% endblock %}

{% block uc_js %}

<!-- 提交个性签名 -->
<script>
        function operateFocus(){
            t1 = $("#uc_intro").val();
            console.log("已存签名"+t1);
        }
        function operateBlur(){
            var intro = $("#uc_intro").val();
            if (t1==intro){

            }
            else{
                $.ajax({
                    url: '{% url 'uc:intro' %}',
                    type: "POST",
                    dataType: 'json',
                    data: {"intro":intro},
                    success: function (data){
                        console.log(data.msg)
                    },
                    error:function (data) {
                        alert('签名错误'+data);
                        console.log(data);
                    },
                    // 解决csrftoken
                    beforeSend: function(xhr, settings) {
                        xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                    },
                });
            }
        }
    </script>

{% endblock %}